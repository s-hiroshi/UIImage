(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){function expandedIndex(k,i,j,imageData){var length=imageData.width*imageData.height*4;if(k===0){if(i===-1&&j===-1){return{i:-i,j:-j}}if(i===-1&&j===0){return{i:-i,j:j}}if(i===-1&&j===1){return{i:-i,j:j}}if(i===0&&j===-1){return{i:i,j:-j}}if(i===1&&j===-1){return{i:i,j:-j}}return{i:i,j:j}}if(k===length-imageData.width*4){if(i===-1&&j===-1){return{i:i,j:-j}}if(i===0&&j===-1){return{i:i,j:-j}}if(i===1&&j===-1){return{i:-i,j:-j}}if(i===1&&j===0){return{i:-i,j:j}}if(i===1&&j===1){return{i:-i,j:j}}return{i:i,j:j}}if(k===(imageData.width-1)*4){if(i===-1&&j===-1){return{i:-i,j:j}}if(i===-1&&j===0){return{i:-i,j:j}}if(i===-1&&j===1){return{i:-i,j:-j}}if(i===0&&j===1){return{i:i,j:-j}}if(i===1&&j===1){return{i:i,j:-j}}return{i:i,j:j}}if(k===length-4){if(i===-1&&j===1){return{i:i,j:-j}}if(i===0&&j===1){return{i:i,j:-j}}if(i===1&&j===-1){return{i:-i,j:j}}if(i===1&&j===0){return{i:-i,j:j}}if(i===1&&j===1){return{i:-i,j:-j}}return{i:i,j:j}}if(k%(imageData.width*4)===0){if(j===-1){return{i:i,j:-j}}return{i:i,j:j}}if((length-4-k)%imageData.width*4===0){if(j===1){return{i:i,j:-j}}return{i:i,j:j}}if(k<imageData.width*4){if(i===-1){return{i:-i,j:j}}return{i:i,j:j}}if(k>length-1-imageData.width*4){if(i===1){return{i:-i,j:j}}return{i:i,j:j}}return{i:i,j:j}}return{expandedIndex:expandedIndex}}()},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){var linearFilter=void 0;function setLinearFilter(filter){linearFilter=filter}var spatialFilter=void 0;function setSpatialFilter(filter){spatialFilter=filter}function run(k,imageData,name){if(linearFilter.is(name)===true){return linearFilter.run(k,imageData,name)}if(spatialFilter.is(name)===true){return spatialFilter.run(k,imageData,name)}return false}return{setLinearFilter:setLinearFilter,setSpatialFilter:setSpatialFilter,run:run}}()},{}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){var filters={};filters["reverse"]=function(i,imageData){var rgba={};rgba.r=255-imageData.data[i];rgba.g=255-imageData.data[i+1];rgba.b=255-imageData.data[i+2];rgba.a=imageData.data[i+3];return rgba};filters["mono"]=function(i,imageData){var rgba={};var color=parseInt((imageData.data[i]+imageData.data[i+1]+imageData.data[i+2])/3,10);color=color<128?0:255;rgba.r=rgba.g=rgba.b=color;rgba.a=imageData.data[i+3];return rgba};filters["simpleGrayscale"]=function(i,imageData){var rgba={};var average=parseInt((imageData.data[i]+imageData.data[i+1]+imageData.data[i+2])/3,10);rgba.r=rgba.g=rgba.b=average;rgba.a=imageData.data[i+3];return rgba};filters["grayscale"]=function(i,imageData){var rgba={};var color=parseInt((imageData.data[i]+imageData.data[i+1]+imageData.data[i+2])/3,10);rgba.r=rgba.g=rgba.b=color;rgba.a=imageData.data[i+3];return rgba};filters["bright"]=function(i,imageData){var rgba={};var inc=4;rgba.r=imageData.data[i]+inc<255?imageData.data[i]+inc:255;rgba.g=imageData.data[i+1]+inc<255?imageData.data[i+1]+inc:255;rgba.b=imageData.data[i+2]+inc<255?imageData.data[i+2]+inc:255;rgba.a=imageData.data[i+3];return rgba};filters["sepia"]=function(i,imageData){var rgba={};var average=parseInt(imageData.data[i]*.298912+imageData.data[i+1]*.586611+imageData.data[i+2]*.114478,10);rgba.r=rgba.g=rgba.b=average;rgba.a=imageData.data[i+3];rgba.r*=.9;rgba.g*=.7;rgba.b*=.4;return rgba};filters["red"]=function(i,imageData){var rgba={};rgba.r=imageData.data[i];rgba.r=rgba.r<250?rgba.r+5:255;rgba.g=imageData.data[i+1];rgba.b=imageData.data[i+2];rgba.a=imageData.data[i+3];return rgba};filters["green"]=function(i,imageData){var rgba={};rgba.r=imageData.data[i];rgba.g=imageData.data[i+1];rgba.g=rgba.g<250?rgba.g+5:255;rgba.b=imageData.data[i+2];rgba.a=imageData.data[i+3];return rgba};filters["blue"]=function(i,imageData){var rgba={};rgba.r=imageData.data[i];rgba.g=imageData.data[i+1];rgba.b=imageData.data[i+2];rgba.b=rgba.b<250?rgba.b+5:255;rgba.a=imageData.data[i+3];return rgba};function is(name){return typeof filters[name]==="function"}function perform(i,imageData,name){return filters[name](i,imageData)}function run(i,imageData,name){return perform(i,imageData,name)}return{is:is,run:run}}()},{}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){var boundary=void 0;function setBoundary(target){boundary=target}var operator={smooth:[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],mean:[1/16,2/16,1/16,2/16,4/16,2/16,1/16,2/16,1/16],sharpen:[0,-1,0,-1,5,-1,0,-1,0],sharpen2:[-1,-1,-1,-1,9,-1,-1,-1,-1],differentialH:[0,0,0,0,-1,1,0,0,0],differentialV:[0,1,0,0,-1,0,0,0,0],prewitt:[-1,0,1,-1,0,1,-1,0,1],sobel:[-1,0,1,-2,0,2,-1,0,1],emboss:[1,0,0,0,-1,0,0,0,0]};function filter(k,imageData,name){if(operator[name]instanceof Array===false){throw new Error("フィルターがありません。")}var rgba={};rgba.r=rgba.g=rgba.b=0;var i,j,n,count=0,index={};for(i=-1;i<=1;i++){for(j=-1;j<=1;j++){index=boundary.expandedIndex(k,i,j,imageData);n=k+(index.i*3+index.j)*4;rgba.r+=parseInt(operator[name][count]*imageData.data[n],10);rgba.g+=parseInt(operator[name][count]*imageData.data[n+1],10);rgba.b+=parseInt(operator[name][count]*imageData.data[n+2],10);count++}}rgba.a=imageData.data[k+3];return rgba}function is(name){return $.inArray(name,operator)!==false}function run(i,imageData,name){return filter(i,imageData,name)}return{setBoundary:setBoundary,is:is,run:run}}()},{}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){var originalData=void 0;function setOriginalData(imageData){originalData=imageData}var widthElem=void 0;function setWidthElem(target){target=target instanceof jQuery?target:$(target);widthElem=target}var heightElem=void 0;function setHeightElem(target){heightElem=target}function getOriginalData(){return originalData}function setOriginalWidth(canvasWidth){widthElem.val(canvasWidth)}function setOriginalHeight(canvasHeight){heightElem.val(canvasHeight)}return{setOriginalData:setOriginalData,getOriginalData:getOriginalData,setWidthElem:setWidthElem,setHeightElem:setHeightElem,setOriginalWidth:setOriginalWidth,setOriginalHeight:setOriginalHeight}}()},{}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){var filter=void 0;function setFilter(target){filter=target}function run(imageData,name){var i,j,k,rgba={},data=[];for(i=0;i<imageData.height;i++){for(j=0;j<imageData.width;j++){k=(i*imageData.width+j)*4;rgba=filter.run(k,imageData,name);data[k]=rgba.r;data[k+1]=rgba.g;data[k+2]=rgba.b;data[k+3]=rgba.a}}return data}return{setFilter:setFilter,run:run}}()},{}],7:[function(require,module,exports){"use strict";var _original=require("./data/original.js");var _original2=_interopRequireDefault(_original);var _uploader=require("./uploader/uploader.js");var _uploader2=_interopRequireDefault(_uploader);var _resize=require("./transform/resize.js");var _resize2=_interopRequireDefault(_resize);var _rotate=require("./transform/rotate.js");var _rotate2=_interopRequireDefault(_rotate);var _validation=require("./validation/validation.js");var _validation2=_interopRequireDefault(_validation);var _boundary=require("./Filter/boundary.js");var _boundary2=_interopRequireDefault(_boundary);var _linearfilter=require("./Filter/linearfilter.js");var _linearfilter2=_interopRequireDefault(_linearfilter);var _spatialfilter=require("./Filter/spatialfilter.js");var _spatialfilter2=_interopRequireDefault(_spatialfilter);var _filters=require("./Filter/filters.js");var _filters2=_interopRequireDefault(_filters);var _processing=require("./filter/processing.js");var _processing2=_interopRequireDefault(_processing);var _trim=require("./trim/trim.js");var _trim2=_interopRequireDefault(_trim);var _circle=require("./trim/circle.js");var _circle2=_interopRequireDefault(_circle);var _lettering=require("./lettering/lettering.js");var _lettering2=_interopRequireDefault(_lettering);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var canvas=$("#canvas").get(0);var ctx=canvas.getContext("2d");_original2.default.setWidthElem($("#original-width"));_original2.default.setHeightElem($("#original-height"));_uploader2.default.setOriginal(_original2.default);_uploader2.default.setDragDrop(canvas);_spatialfilter2.default.setBoundary(_boundary2.default);_filters2.default.setLinearFilter(_linearfilter2.default);_filters2.default.setSpatialFilter(_spatialfilter2.default);_processing2.default.setFilter(_filters2.default);$("#uploader").bind("change",function(){var file=this.files[0];if(_uploader2.default.checkFormat(file.type)===false){return false}_uploader2.default.drawFile(file,canvas)});$("#original").on("click",function(){var originalData=_original2.default.getOriginalData();canvas.width=originalData.width;canvas.height=originalData.height;ctx.clearRect(0,0,originalData.width,_original2.default.height);ctx.putImageData(originalData,0,0);$("#original-width").val(originalData.width);$("#original-height").val(originalData.height)});$("#resize").on("click",function(){var size={width:$("#width").val(),height:$("#height").val()};var ratio=$("#ratio").is(":checked");if(!_resize2.default.validate(size,ratio,_validation2.default)){return false}_resize2.default.run(canvas,size,ratio);return false});$("#rotate-right").on("click",function(){_rotate2.default.run(90,canvas);return false});$("#rotate-left").on("click",function(){_rotate2.default.run(-90,canvas);return false});$(".filtering").on("click",function(){var name=$(this).attr("id");var imageData=ctx.getImageData(0,0,canvas.width,canvas.height);imageData.data.set(_processing2.default.run(imageData,name));ctx.putImageData(imageData,0,0);return false});$("#open-trim-selection").on("click",function(){_trim2.default.openSelection($("#trim-selection"));return false});$("#close-trim-selection").on(function(){_trim2.default.closeSelection($("#trim-selection"));return false});$("#trim-selection").on("resize",function(){_trim2.default.resizeSelection($("#trim-width"),$("#trim-height"),$("#trim-selection"));return false});$("#trim-width").on("keyup",function(){_trim2.default.setWidth($(this),$("#trim-selection"));return false});$("#trim-height").on("keyup",function(){_trim2.default.setHeight($(this),$("#trim-selection"));return false});$("#trimming").on("click",function(){_trim2.default.run(canvas,$("#trim-selection"));return false});$("#trimming-circle").on("click",function(){_circle2.default.run(canvas)});$(".lettering").on("click",function(){var letter=$(".lettering-input").val();var pos={top:$(".lettering-top").val(),left:$(".lettering-left").val()};var size=$(".lettering-size").val();var color=$(".lettering-color").val();var family="sans-serif";_lettering2.default.draw(canvas,letter,pos,color,size,family);return false});$("#save").on("click",function(){$("#save-dialog img").remove();var canvasData=canvas.toDataURL();var width=canvas.width+40;var height=canvas.height+80;$("#save-dialog").dialog({width:width,height:height});var img=$("<img>");img.width=canvas.width;img.height=canvas.height;img.appendTo($("#save-dialog"));img.get(0).setAttribute("src",canvasData)})},{"./Filter/boundary.js":1,"./Filter/filters.js":2,"./Filter/linearfilter.js":3,"./Filter/spatialfilter.js":4,"./data/original.js":5,"./filter/processing.js":6,"./lettering/lettering.js":8,"./transform/resize.js":9,"./transform/rotate.js":10,"./trim/circle.js":11,"./trim/trim.js":12,"./uploader/uploader.js":13,"./validation/validation.js":14}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){function syncText(input,output){}function closeLayer(){if(typeof textOutput!=="undefined"){$(textOutput).remove()}if(typeof textTool!=="undefined"){$(textTool).remove()}}function getPosition(elem){elem=elem instanceof jQuery?elem:$(elem);return elem.position()}function draw(canvas,letter,pos,color,size,family){var ctx=canvas.getContext("2d");if(letter===""){return false}ctx.font=size+"px "+family;ctx.fillStyle="#"+color;ctx.fillText(letter,pos.left,pos.top);return false}return{getPosition:getPosition,draw:draw}}()},{}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){function getFixSize(imageData,size){var scale=void 0;if(size.width!==""){scale=size.width/imageData.width}else{scale=size.height/imageData.height}return{width:Math.round(imageData.width*scale),height:Math.round(imageData.height*scale)}}function draw(canvas,before,after){var canvasData=canvas.toDataURL();var img=$("<img>").get(0);img.onload=function(){return function(){var ctx=canvas.getContext("2d");canvas.width=after.width;canvas.height=after.height;img.width=after.width;img.height=after.height;ctx.clearRect(0,0,canvas.width,canvas.height);ctx.drawImage(img,0,0,img.width,img.height);$(img).remove()}}();img.setAttribute("src",canvasData)}function validate(size,ratio,validation){if(ratio===false){if(!validation.isMoreThan0(size.width)||!validation.isMoreThan0(size.height)){window.alert("横、縦へ0より大きな数を入力してください。");return false}}if(ratio===true){if(!validation.isNotEmpty(size.width)&&!validation.isNotEmpty(size.height)){window.alert("横、縦のどちらか0より大きな数を入力してください。");return false}}return true}function run(canvas,size,ratio){var before={width:canvas.width,height:canvas.height};var after=void 0;if(ratio===true){after=getFixSize(canvas,size)}else{after=size}draw(canvas,before,after)}return{run:run,validate:validate}}()},{}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){function rotate(angle,canvas,img){return function(){var ctx=canvas.getContext("2d");var width=canvas.width;var height=canvas.height;canvas.width=height;canvas.height=width;ctx.clearRect(0,0,canvas.width,canvas.height);ctx.translate(canvas.width/2,canvas.height/2);ctx.rotate(angle*Math.PI/180);ctx.translate(-img.width/2,-img.height/2);ctx.drawImage(img,0,0,img.width,img.height)}}function run(angle,canvas){var canvasData=canvas.toDataURL();var img=$("<img>").get(0);img.onload=rotate(angle,canvas,img);img.setAttribute("src",canvasData)}return{run:run}}()},{}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){function openSelection(elem){var selection=elem instanceof jQuery?elem:$(elem);selection.resizable();selection.draggable();selection.css({display:"block"})}function closeSelection(elem){var selection=elem instanceof jQuery?elem:$(elem);selection.css("display","none")}function resizeSelection(rect,rectWidth,rectHeight){rect=rect instanceof jQuery?rect:$(rect);rectWidth=rectWidth instanceof jQuery?rectWidth:$(rectWidth);rectHeight=rectHeight instanceof jQuery?rectHeight:$(rectHeight);rectWidth.val(rect.width());rectHeight.val(rect.height())}function setWidth(elem,rect){elem=elem instanceof jQuery?elem:$(elem);rect=rect instanceof jQuery?rect:$(rect);if(elem.val()===""){return false}var width=parseInt(elem.val(),10);if(isNaN(width)){alert("数字を入力してください。")}if(width>0===false){alert("0より大きい整数を入力してください。");return false}rect.css("width",width+"px")}function setHeight(elem,rect){elem=elem instanceof jQuery?elem:$(elem);rect=rect instanceof jQuery?rect:$(rect);if(elem.val()===""){return false}var height=parseInt(elem.val(),10);if(isNaN(height)){alert("数字を入力してください。")}if(height>0===false){alert("0より大きい数字を入力してください。");return false}rect.css("height",height+"px")}function run(canvas,selection){var ctx=canvas.getContext("2d");var bufferCanvas=document.createElement("canvas");var bufferCtx=bufferCanvas.getContext("2d");bufferCtx.drawImage(canvas,0,0);ctx.beginPath();ctx.rect(0,0,canvas.width,canvas.height);ctx.fillStyle="rgb(255,255,255)";ctx.fill();var x=canvas.width/2;var y=canvas.height/2;var radius=x-y>=0?x/2:y/2;ctx.beginPath();ctx.arc(x,y,radius,0,2*Math.PI,false);ctx.clip();ctx.drawImage(bufferCanvas,0,0)}return{openSelection:openSelection,closeSelection:closeSelection,resizeSelection:resizeSelection,setWidth:setWidth,setHeight:setHeight,run:run}}()},{}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){function openSelection(elem){var selection=elem instanceof jQuery?elem:$(elem);selection.resizable();selection.draggable();selection.css({display:"block"})}function closeSelection(elem){var selection=elem instanceof jQuery?elem:$(elem);selection.css("display","none")}function resizeSelection(rect,rectWidth,rectHeight){rect=rect instanceof jQuery?rect:$(rect);rectWidth=rectWidth instanceof jQuery?rectWidth:$(rectWidth);rectHeight=rectHeight instanceof jQuery?rectHeight:$(rectHeight);rectWidth.val(rect.width());rectHeight.val(rect.height())}function setWidth(elem,rect){elem=elem instanceof jQuery?elem:$(elem);rect=rect instanceof jQuery?rect:$(rect);if(elem.val()===""){return false}var width=parseInt(elem.val(),10);if(isNaN(width)){alert("数字を入力してください。")}if(width>0===false){alert("0より大きい整数を入力してください。");return false}rect.css("width",width+"px")}function setHeight(elem,rect){elem=elem instanceof jQuery?elem:$(elem);rect=rect instanceof jQuery?rect:$(rect);if(elem.val()===""){return false}var height=parseInt(elem.val(),10);if(isNaN(height)){alert("数字を入力してください。")}if(height>0===false){alert("0より大きい数字を入力してください。");return false}rect.css("height",height+"px")}function run(canvas,selection){var ctx=canvas.getContext("2d");var rect={};rect.top=parseInt(selection.css("top"),10);rect.left=parseInt(selection.css("left"),10);rect.width=selection.width();rect.height=selection.height();selection.css({display:"none"});var data=ctx.getImageData(rect.left,rect.top,rect.width,rect.height);canvas.width=data.width;canvas.height=data.height;ctx.putImageData(data,0,0)}return{openSelection:openSelection,closeSelection:closeSelection,resizeSelection:resizeSelection,setWidth:setWidth,setHeight:setHeight,run:run}}()},{}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){var original=void 0;function setOriginal(target){original=target}function checkFormat(format){if(format.match(/^image\/(png|jpeg)$/)===null){alert("対応していないファイル形式です。\n                PNGまたはJPGファイルを選択してください。");return false}return true}function imgToCanvas(img,canvas){return function(){try{var ctx=canvas.getContext("2d");canvas.width=img.width;canvas.height=img.height;ctx.clearRect(0,0,canvas.width,canvas.height);ctx.drawImage(img,0,0);$(img).remove();var originalData=ctx.getImageData(0,0,canvas.width,canvas.height);original.setOriginalData(originalData);original.setOriginalWidth(canvas.width);original.setOriginalHeight(canvas.height)}catch(e){alert("画像をcanvasへ描画できませんでした。");return false}}}function readFile(reader,canvas){return function(){var img=$("<img>").get(0);img.onload=imgToCanvas(img,canvas);img.setAttribute("src",reader.result)}}function drawFile(file,canvas){var reader=new FileReader;reader.onload=readFile(reader,canvas);reader.readAsDataURL(file)}function setDragDrop(canvas){canvas.ondragover=function(){return false};canvas.ondrop=function(evt){var file=void 0;if(evt.dataTransfer.files.length===0){return false}file=evt.dataTransfer.files[0];if(checkFormat(file.type)===false){alert("対応していないファイル形式です。\n                    PNGまたはjPGファイルを選択してください。")}drawFile(file,canvas);return false}}return{setOriginal:setOriginal,checkFormat:checkFormat,setDragDrop:setDragDrop,drawFile:drawFile}}()},{}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){function isNotEmpty(values){var operands=[];if(typeof values==="undefined"){return false}if(values instanceof Array===false){operands.push(values)}else{operands=values}for(var i=0;i<operands.length;i++){if(typeof operands[i]==="undefined"){return false}if(operands[i]===null){return false}if(operands[i]===""){return false}}return true}function isMoreThan0(num){var result=parseInt(num,10);if(isNaN(result)){return false}if(num<=0===true){return false}return true}return{isNotEmpty:isNotEmpty,isMoreThan0:isMoreThan0}}()},{}]},{},[7]);